@page "/Entradas/Create"
@using P1_ap1_FelixMunoz.Models
@using P1_ap1_FelixMunoz.Services
@inject HuacalesService huacalesService
@inject NavigationManager navigationManager
@rendermode InteractiveServer

<PageTitle>Registrar Entrada de Huacales</PageTitle>

<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-white text-center">
            <h5 class="mb-0">Registrar Entrada de Huacales</h5>
        </div>
        <div class="card-body">
            <EditForm Model="entrada" OnValidSubmit="Guardar">
                <DataAnnotationsValidator />
                <ValidationSummary />

                
                <div class="mb-3">
                    <label class="form-label fw-bold">Fecha</label>
                    <InputDate class="form-control" @bind-Value="entrada.Fecha" />
                    <ValidationMessage For="@(() => entrada.Fecha)" />
                </div>

               
                <div class="mb-3">
                    <label class="form-label fw-bold">Nombre del Cliente</label>
                    <InputText class="form-control" @bind-Value="entrada.NombreCliente" />
                    <ValidationMessage For="@(() => entrada.NombreCliente)" />
                </div>

                
                <div class="mb-3">
                    <label class="form-label fw-bold">Cantidad</label>
                    <InputNumber class="form-control" @bind-Value="entrada.Cantidad" />
                    <ValidationMessage For="@(() => entrada.Cantidad)" />
                </div>

            
                <div class="mb-3">
                    <label class="form-label fw-bold">Precio</label>
                    <InputNumber class="form-control" @bind-Value="entrada.Precio" />
                    <ValidationMessage For="@(() => entrada.Precio)" />
                </div>

              
                <div class="d-flex justify-content-end gap-2 mt-3">
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-save me-1"></i> Guardar
                    </button>
                    <a href="/Entradas/Index" class="btn btn-secondary">
                        <i class="bi bi-arrow-left me-1"></i> Cancelar
                    </a>
                </div>
            </EditForm>
        </div>
    </div>
</div>

@if (!string.IsNullOrEmpty(mensajeError))
{
    <div class="alert alert-danger mt-2">@mensajeError</div>
}

@code {
    private string mensajeError = string.Empty;

    private EntradasHuacales entrada = new()
    {
        Fecha = DateTime.Today
    };

    private async Task Guardar()
    {
        if (await huacalesService.Guardar(entrada))
            navigationManager.NavigateTo("/Entradas/Index");
        else
            mensajeError = " Ya existe una entrada con ese cliente y fecha.";
    }
}

